<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini E-Ticaret API Demo</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root { --bg:#0f172a; --card:#111827; --accent:#06b6d4; --text:#e5e7eb; --muted:#94a3b8; }
        body { margin:0; font-family: "Inter", system-ui, -apple-system, sans-serif; background: radial-gradient(circle at 20% 20%, #0f172a 0, #0b1226 35%, #060c1a 70%); color: var(--text); }
        .shell { max-width: 1100px; margin: 32px auto; padding: 0 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(320px,1fr)); gap: 16px; }
        .card { background: linear-gradient(135deg, rgba(17,24,39,0.95), rgba(17,24,39,0.8)); border: 1px solid rgba(255,255,255,0.06); border-radius: 14px; padding: 16px; box-shadow: 0 12px 30px rgba(0,0,0,0.35); backdrop-filter: blur(6px); }
        h2 { margin: 0 0 12px; font-size: 18px; letter-spacing: 0.2px; }
        label { display: block; font-size: 13px; color: var(--muted); margin: 10px 0 4px; }
        input, select, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); color: var(--text); outline: none; }
        textarea { min-height: 60px; resize: vertical; }
        button { margin-top: 10px; width: 100%; padding: 11px 12px; border-radius: 10px; border: none; background: linear-gradient(135deg, #06b6d4, #3b82f6); color: #0b1120; font-weight: 700; cursor: pointer; }
        .pill { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.06); padding: 6px 10px; border-radius: 999px; font-size: 12px; }
        .list { display: flex; flex-direction: column; gap: 8px; max-height: 380px; overflow-y: auto; }
        .item { padding: 10px 12px; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; background: rgba(255,255,255,0.02); }
        .muted { color: var(--muted); font-size: 13px; }
        pre { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 10px; overflow: auto; }
        .row { display: flex; gap: 8px; }
        .row > * { flex: 1; }
    </style>
</head>
<body>
<div class="shell" id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const api = async (path, { method = "GET", body, token } = {}) => {
  const res = await fetch(path, {
    method,
    headers: {
      "Content-Type": "application/json",
      ...(token ? { Authorization: `Bearer ${token}` } : {})
    },
    body: body ? JSON.stringify(body) : undefined
  });
  const text = await res.text();
  let data;
  try { data = text ? JSON.parse(text) : null; } catch (e) { data = text; }
  if (!res.ok) {
    const msg = data && (data.message || data.detail) ? (data.message || data.detail) : res.statusText;
    throw new Error(msg);
  }
  return data;
};

function App() {
  const [token, setToken] = useState("");
  const [email, setEmail] = useState("admin@example.com");
  const [password, setPassword] = useState("Passw0rd!");
  const [categories, setCategories] = useState([]);
  const [products, setProducts] = useState([]);
  const [catForm, setCatForm] = useState({ name: "Elektronik", slug: "elektronik" });
  const [prodForm, setProdForm] = useState({
    name: "Kulaklık",
    description: "Kablosuz kulaklık",
    price: 199.9,
    currency: "TRY",
    sku: "SKU-001",
    categoryId: "",
    stockQuantity: 10,
    status: "ACTIVE",
    images: []
  });
  const [log, setLog] = useState("");

  const logMsg = (msg) => setLog(prev => `${msg}\n${prev}`);

  const loadCatalog = async () => {
    try {
      const cats = await api("/api/catalog/categories");
      setCategories(cats);
      if (!prodForm.categoryId && cats.length) {
        setProdForm(f => ({ ...f, categoryId: cats[0].id }));
      }
      const prods = await api("/api/catalog/products");
      setProducts(prods);
    } catch (e) {
      logMsg(`Katalog yüklenemedi: ${e.message}`);
    }
  };

  useEffect(() => { loadCatalog(); }, []);

  const handleLogin = async () => {
    try {
      const res = await api("/api/auth/login", { method: "POST", body: { email, password } });
      setToken(res.accessToken);
      logMsg("Giriş başarılı, token hazır.");
    } catch (e) {
      logMsg(`Login hatası: ${e.message}`);
    }
  };

  const handleCreateCategory = async () => {
    if (!token) { logMsg("Token yok."); return; }
    try {
      await api("/api/catalog/categories", { method: "POST", body: catForm, token });
      logMsg("Kategori oluşturuldu.");
      await loadCatalog();
    } catch (e) {
      logMsg(`Kategori hatası: ${e.message}`);
    }
  };

  const handleCreateProduct = async () => {
    if (!token) { logMsg("Token yok."); return; }
    try {
      await api("/api/catalog/products", { method: "POST", body: prodForm, token });
      logMsg("Ürün oluşturuldu.");
      await loadCatalog();
    } catch (e) {
      logMsg(`Ürün hatası: ${e.message}`);
    }
  };

  return (
    <div className="grid">
      <div className="card">
        <h2>JWT Giriş</h2>
        <label>Email</label>
        <input value={email} onChange={e => setEmail(e.target.value)} />
        <label>Şifre</label>
        <input type="password" value={password} onChange={e => setPassword(e.target.value)} />
        <button onClick={handleLogin}>Giriş yap</button>
        {token && <div className="pill" style={{marginTop:8}}>Token alındı</div>}
      </div>

      <div className="card">
        <h2>Kategori Oluştur (ADMIN)</h2>
        <label>İsim</label>
        <input value={catForm.name} onChange={e => setCatForm(f => ({...f, name: e.target.value}))} />
        <label>Slug</label>
        <input value={catForm.slug} onChange={e => setCatForm(f => ({...f, slug: e.target.value}))} />
        <button onClick={handleCreateCategory}>Kategori ekle</button>
      </div>

      <div className="card">
        <h2>Ürün Oluştur (ADMIN)</h2>
        <label>İsim</label>
        <input value={prodForm.name} onChange={e => setProdForm(f => ({...f, name: e.target.value}))} />
        <label>Açıklama</label>
        <textarea value={prodForm.description} onChange={e => setProdForm(f => ({...f, description: e.target.value}))} />
        <div className="row">
          <div>
            <label>Fiyat</label>
            <input type="number" step="0.01" value={prodForm.price} onChange={e => setProdForm(f => ({...f, price: parseFloat(e.target.value)}))} />
          </div>
          <div>
            <label>Para Birimi</label>
            <input value={prodForm.currency} maxLength={3} onChange={e => setProdForm(f => ({...f, currency: e.target.value.toUpperCase()}))} />
          </div>
        </div>
        <label>SKU</label>
        <input value={prodForm.sku} onChange={e => setProdForm(f => ({...f, sku: e.target.value}))} />
        <label>Kategori</label>
        <select value={prodForm.categoryId} onChange={e => setProdForm(f => ({...f, categoryId: e.target.value}))}>
          {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
        </select>
        <div className="row">
          <div>
            <label>Stok</label>
            <input type="number" value={prodForm.stockQuantity} onChange={e => setProdForm(f => ({...f, stockQuantity: parseInt(e.target.value || 0)}))} />
          </div>
          <div>
            <label>Durum</label>
            <select value={prodForm.status} onChange={e => setProdForm(f => ({...f, status: e.target.value}))}>
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>
          </div>
        </div>
        <button onClick={handleCreateProduct}>Ürün ekle</button>
      </div>

      <div className="card">
        <h2>Kategoriler</h2>
        <div className="list">
          {categories.map(c => (
            <div key={c.id} className="item">
              <div>{c.name}</div>
              <div className="muted">{c.slug}</div>
            </div>
          ))}
          {!categories.length && <div className="muted">Kategori yok.</div>}
        </div>
      </div>

      <div className="card">
        <h2>Ürünler</h2>
        <div className="list">
          {products.map(p => (
            <div key={p.id} className="item">
              <div style={{display:"flex", justifyContent:"space-between", gap:8}}>
                <span>{p.name}</span>
                <span className="muted">{p.price} {p.currency}</span>
              </div>
              <div className="muted">{p.sku} • {p.categoryName}</div>
            </div>
          ))}
          {!products.length && <div className="muted">Ürün yok.</div>}
        </div>
      </div>

      <div className="card">
        <h2>Log</h2>
        <pre style={{minHeight:160, maxHeight:240}}>{log || "Henüz log yok."}</pre>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
